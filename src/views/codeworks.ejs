<% layout('layout') -%>

<div class="card">
  <h2>Add New Codework</h2>
  <form method="post" action="/admin/codeworks/create">
    <div class="row">
      <div>
        <label>Title*</label>
        <input name="title" required />

        <label>Summary*</label>
        <textarea name="summary" required></textarea>

        <label>Content (Markdown ok)</label>
        <textarea name="content"></textarea>

        <label>Images (one URL per line)</label>
        <textarea name="images"></textarea>
      </div>
      <div>
        <label>Kind*</label>
        <select name="kind" required>
          <option value="featured">featured</option>
          <option value="technical">technical</option>
        </select>

        <label>Status</label>
        <select name="status">
          <option value="draft">draft</option>
          <option value="published" selected>published</option>
        </select>

        <label>Order (bigger = higher)</label>
        <input name="order" type="number" value="0"/>

        <label>GitHub</label>
        <input name="github"/>

        <label>Demo</label>
        <input name="demo"/>

        <label>Tags (comma separated)</label>
        <input name="tags" placeholder="node, express, mongo"/>

        <label>Tech Stack (comma separated)</label>
        <input name="techStack" placeholder="react, tailwind"/>
      </div>
    </div>

    <div style="margin-top:12px">
      <button class="btn primary" type="submit">Create</button>
      <a class="btn" href="/api/codeworks?status=published" target="_blank">View JSON</a>
    </div>
  </form>
</div>

<div class="card">
  <h2>All Codeworks</h2>
  <table>
    <thead>
      <tr>
        <th style="width:28%">Title</th>
        <th>Kind</th>
        <th>Status</th>
        <th>Order</th>
        <th style="width:32%">Links</th>
        <th style="width:14%">Actions</th>
      </tr>
    </thead>
    <tbody>
      <% if ((items||[]).length === 0) { %>
        <tr><td colspan="6" class="muted">No items yet.</td></tr>
      <% } %>
      <% (items||[]).forEach(function(it){ %>
        <tr>
          <td><strong><%= it.title %></strong><br/><span class="muted"><%= it.summary %></span></td>
          <td><%= it.kind %></td>
          <td><%= it.status %></td>
          <td><%= it.order %></td>
          <td class="muted">
            <% if (it.link && it.link.github) { %>GitHub: <a href="<%= it.link.github %>" target="_blank"><%= it.link.github %></a><br/><% } %>
            <% if (it.link && it.link.demo) { %>Demo: <a href="<%= it.link.demo %>" target="_blank"><%= it.link.demo %></a><% } %>
          </td>
          <td class="actions">
            <form method="post" action="/admin/codeworks/<%= it._id %>/delete" onsubmit="return confirm('Delete this item?');">
              <button class="btn danger" type="submit">Delete</button>
            </form>
          </td>
        </tr>
      <% }) %>
    </tbody>
  </table>
</div>
